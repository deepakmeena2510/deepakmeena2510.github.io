<script>
/* ====== ADD FIX (à¤¯à¤¹ à¤ªà¤¹à¤²à¥‡ à¤¨à¤¹à¥€à¤‚ à¤¥à¤¾, à¤‡à¤¸à¥€ à¤µà¤œà¤¹ à¤¸à¥‡ code à¤Ÿà¥‚à¤Ÿ à¤°à¤¹à¤¾ à¤¥à¤¾) ====== */
let bal = document.getElementById("bal");
let payPopup = document.getElementById("payPopup");
let statusPopup = document.getElementById("statusPopup");
let loader = document.getElementById("loader");
let statusText = document.getElementById("statusText");
let method = document.getElementById("method");
let name = document.getElementById("name");
let upi = document.getElementById("upi");
/* =================================================================== */

if(!localStorage.getItem("balance")){
  localStorage.setItem("balance",500);
}

let balance = Number(localStorage.getItem("balance"));
bal.innerText = balance;

let history = JSON.parse(localStorage.getItem("history") || "[]");
let withdrawAmount = 0;

let amounts = [10,30,50,100,200,500];
let list = document.getElementById("withdrawList");

function renderWithdraw(){
  list.innerHTML="";
  amounts.forEach(a=>{
    let d=document.createElement("div");
    d.className="row";
    d.innerHTML=`â‚¹ ${a} <button class="btn">Withdraw</button>`;
    d.querySelector("button").onclick=()=>{
      if(balance<a){
        openStatus("âŒ Balance à¤•à¤® à¤¹à¥ˆ");
        return;
      }
      withdrawAmount=a;
      payPopup.style.display="flex";
    };
    list.appendChild(d);
  });
}
renderWithdraw();

function confirmWithdraw(){
  let m=method.value;
  let n=name.value.trim();
  let u=upi.value.trim();

  if(!m||!n||!u){
    openStatus("âŒ Details à¤­à¤°à¥‡à¤‚");
    return;
  }
  if(!u.includes("@")){
    openStatus("âŒ Invalid UPI");
    return;
  }

  payPopup.style.display="none";

  // STEP 1 : PROCESSING
  statusPopup.style.display="flex";
  loader.style.display="block";
  statusText.innerText="â³ Processing...";

  setTimeout(()=>{
    statusText.innerText="ðŸ”” Pending";

    // STEP 2 : SUCCESS
    setTimeout(()=>{
      loader.style.display="none";
      statusText.innerText="âœ… Withdraw Successful";

      balance -= withdrawAmount;
      localStorage.setItem("balance",balance);
      bal.innerText = balance;

      history.unshift({
        amount:withdrawAmount,
        method:m,
        status:"Success",
        time:new Date().toLocaleString()
      });
      localStorage.setItem("history",JSON.stringify(history));

      setTimeout(()=>{
        statusPopup.style.display="none";
      },2000);

    },2000);

  },1000);
}

function openStatus(msg){
  statusPopup.style.display="flex";
  loader.style.display="none";
  statusText.innerText=msg;
  setTimeout(()=>statusPopup.style.display="none",2000);
}
</script>
