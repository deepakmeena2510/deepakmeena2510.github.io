<script>
// ===== INITIAL =====
if(!localStorage.getItem("balance")){
  localStorage.setItem("balance",500);
}

let balance = Number(localStorage.getItem("balance"));
document.getElementById("bal").innerText = balance;

let withdrawAmount = 0;

// üëâ success ‡§π‡•Å‡§è amount store ‡§π‡•ã‡§Ç‡§ó‡•á
let usedWithdraw = JSON.parse(localStorage.getItem("usedWithdraw") || "[]");

// withdraw options
let amounts = [10,30,50,100,200,500];
let list = document.getElementById("withdrawList");

// ===== RENDER WITHDRAW =====
function renderWithdraw(){
  list.innerHTML="";

  amounts.forEach(a=>{

    // ‚ùå 10,30,50,100 ‡§è‡§ï ‡§¨‡§æ‡§∞ success ‡§ï‡•á ‡§¨‡§æ‡§¶ hide
    if(a <= 100 && usedWithdraw.includes(a)) return;

    let div=document.createElement("div");
    div.className="row";
    div.innerHTML=`
      <span>‚Çπ ${a}</span>
      <button class="btn">Withdraw</button>
    `;

    div.querySelector("button").onclick=()=>{
      if(balance < a){
        showStatus("‚ùå Balance ‡§ï‡§Æ ‡§π‡•à","fail");
        return;
      }
      withdrawAmount = a;
      payPopup.style.display="flex";
    };

    list.appendChild(div);
  });
}
renderWithdraw();

// ===== CONFIRM WITHDRAW =====
function confirmWithdraw(){
  let m = method.value;
  let u = upi.value.trim();

  if(!m || !u){
    showStatus("‚ùå Details ‡§≠‡§∞‡•á‡§Ç","fail");
    return;
  }
  if(!u.includes("@")){
    showStatus("‚ùå Invalid UPI","fail");
    return;
  }

  payPopup.style.display="none";

  // Processing
  statusPopup.style.display="flex";
  loader.style.display="block";
  statusText.innerText="‚è≥ Processing...";

  // Pending
  setTimeout(()=>{
    statusText.innerText="üîî Pending";
  },1500);

  // Success
  setTimeout(()=>{
    loader.style.display="none";
    statusText.innerText="‚úÖ Payment Successful";

    balance -= withdrawAmount;
    localStorage.setItem("balance",balance);
    bal.innerText = balance;

    // üëâ 10,30,50,100 ‡§ï‡•ã ‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§ï‡•á ‡§¨‡§æ‡§¶ hide ‡§ï‡§∞‡§®‡§æ
    if(withdrawAmount <= 100 && !usedWithdraw.includes(withdrawAmount)){
      usedWithdraw.push(withdrawAmount);
      localStorage.setItem("usedWithdraw",JSON.stringify(usedWithdraw));
    }

    setTimeout(()=>{
      statusPopup.style.display="none";
      renderWithdraw();
    },2000);

  },3500);
}

// ===== STATUS =====
function showStatus(msg,type){
  statusPopup.style.display="flex";
  statusText.innerText=msg;
  statusText.className=type;
  loader.style.display="none";

  setTimeout(()=>{
    statusPopup.style.display="none";
    loader.style.display="block";
  },2000);
}
</script>
