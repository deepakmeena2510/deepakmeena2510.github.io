<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Wallet Withdraw</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f2f2f2}
.header{background:#16a085;color:#fff;padding:16px;text-align:center;font-size:20px}
.box{background:#fff;margin:15px;padding:16px;border-radius:12px}
.row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.btn{background:#2ecc71;color:#fff;border:none;border-radius:20px;padding:8px 16px}
.popup{position:fixed;top:0;left:0;width:100%;height:100%;display:none;
background:rgba(0,0,0,.6);align-items:center;justify-content:center}
.card{background:#fff;width:85%;padding:20px;border-radius:14px;text-align:center}
input,select{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ccc}
.spinner{width:40px;height:40px;border:4px solid #ddd;border-top:4px solid #16a085;
border-radius:50%;animation:spin 1s linear infinite;margin:auto}
@keyframes spin{100%{transform:rotate(360deg)}}
.success{color:green}
.pending{color:orange}
.fail{color:red}
</style>
</head>

<body>

<div class="header">ðŸ’¼ Wallet</div>

<div class="box">
<b>ðŸ’° Balance:</b> â‚¹ <span id="bal">0</span>
</div>

<div class="box" id="withdrawList"></div>

<!-- Payment Popup -->
<div class="popup" id="payPopup">
  <div class="card">
    <h3>Withdraw Details</h3>
    <select id="method">
      <option value="">Select Method</option>
      <option>UPI</option>
      <option>Paytm</option>
      <option>PhonePe</option>
      <option>Google Pay</option>
    </select>
    <input id="upi" placeholder="Enter UPI ID">
    <br><br>
    <button class="btn" onclick="confirmWithdraw()">Confirm</button>
  </div>
</div>

<!-- Status Popup -->
<div class="popup" id="statusPopup">
  <div class="card">
    <div id="loader" class="spinner"></div>
    <p id="statusText"></p>
  </div>
</div>

<script>
// ===== INITIAL =====
if(!localStorage.getItem("balance")){
  localStorage.setItem("balance",500);
}
let balance = Number(localStorage.getItem("balance"));
bal.innerText = balance;

let history = JSON.parse(localStorage.getItem("history") || "[]");
let used = JSON.parse(localStorage.getItem("usedAmounts") || "[]");

let withdrawAmount = 0;
let amounts = [10,30,50,100,200,500];
let list = document.getElementById("withdrawList");

// ===== RENDER WITHDRAW =====
function renderWithdraw(){
  list.innerHTML="";
  amounts.forEach(a=>{
    if(a<=100 && used.includes(a)) return;

    let d=document.createElement("div");
    d.className="row";
    d.innerHTML=`<span>â‚¹ ${a}</span><button class="btn">Withdraw</button>`;
    d.querySelector("button").onclick=()=>{
      if(balance<a){
        showStatus("âŒ Balance à¤•à¤® à¤¹à¥ˆ","fail");
        return;
      }
      withdrawAmount=a;
      payPopup.style.display="flex";
    };
    list.appendChild(d);
  });
}
renderWithdraw();

// ===== CONFIRM =====
function confirmWithdraw(){
  let m=method.value;
  let u=upi.value.trim();

  if(!m || !u){
    showStatus("âŒ Details à¤­à¤°à¥‡à¤‚","fail");
    return;
  }
  if(!u.includes("@")){
    showStatus("âŒ Invalid UPI ID","fail");
    return;
  }

  payPopup.style.display="none";

  statusPopup.style.display="flex";
  loader.style.display="block";
  statusText.className="pending";
  statusText.innerText="â³ Processing...";

  setTimeout(()=>{
    statusText.innerText="ðŸ”” Pending";
  },1500);

  setTimeout(()=>{
    loader.style.display="none";
    statusText.className="success";
    statusText.innerText="âœ… Payment Successful";

    balance-=withdrawAmount;
    localStorage.setItem("balance",balance);
    bal.innerText=balance;

    history.unshift({
      amount:withdrawAmount,
      status:"Success",
      time:new Date().toLocaleString()
    });
    localStorage.setItem("history",JSON.stringify(history));

    if(withdrawAmount<=100 && !used.includes(withdrawAmount)){
      used.push(withdrawAmount);
      localStorage.setItem("usedAmounts",JSON.stringify(used));
    }

    setTimeout(()=>{
      statusPopup.style.display="none";
      renderWithdraw();
    },2000);

  },3500);
}

// ===== STATUS =====
function showStatus(msg,type){
  statusPopup.style.display="flex";
  loader.style.display="none";
  statusText.className=type;
  statusText.innerText=msg;
  setTimeout(()=>statusPopup.style.display="none",2000);
}
</script>

</body>
</html>
