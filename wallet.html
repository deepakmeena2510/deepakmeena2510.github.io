<!DOCTYPE html>
<html>
<head>
<title>Wallet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:sans-serif;background:#f4f6f8}
.header{background:#16a085;color:#fff;padding:18px;text-align:center;font-size:20px}
.box{background:#fff;margin:15px;padding:16px;border-radius:14px;box-shadow:0 5px 12px rgba(0,0,0,.1)}
.row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.btn{padding:8px 16px;border:none;border-radius:20px;background:#2ecc71;color:#fff}
.history-btn{
  width:calc(100% - 30px);
  margin:0 15px 10px;
  padding:12px;
  border:none;
  border-radius:25px;
  background:#3498db;
  color:#fff;
  font-size:16px
}
.popup,.loader{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.card{background:#fff;padding:20px;border-radius:14px;width:85%}
input{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ccc}
.center{text-align:center}
.spinner{width:40px;height:40px;border:4px solid #ddd;border-top:4px solid #16a085;border-radius:50%;animation:spin 1s linear infinite;margin:auto}
@keyframes spin{100%{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="header">ðŸ’¼ Wallet</div>

<!-- HISTORY BUTTON -->
<button class="history-btn" onclick="location.href='withdraw-history.html'">
ðŸ“œ Withdraw History
</button>

<div class="box">
<b>Available Balance:</b> â‚¹ <span id="bal">0</span>
</div>

<div class="box" id="list"></div>

<!-- UPI POPUP -->
<div class="popup" id="popup">
<div class="card">
<h3>UPI Details</h3>
<input id="name" placeholder="Your Name">
<input id="upi" placeholder="UPI ID">
<br><br>
<button class="btn" onclick="submitUPI()">Submit</button>
</div>
</div>

<!-- LOADER -->
<div class="loader" id="loader">
<div class="card center">
<div class="spinner"></div>
<p id="status">Processing...</p>
</div>
</div>

<script>
let balance = Number(localStorage.getItem("balance") || 100);
document.getElementById("bal").innerText = balance;

let history = JSON.parse(localStorage.getItem("history") || "[]");
let usedOnce = JSON.parse(localStorage.getItem("usedOnce") || "[]");

let withdrawLevels = [
  {amt:10, once:true},
  {amt:30, once:true},
  {amt:50, once:true},
  {amt:100, once:true},
  {amt:200, once:false},
  {amt:500, once:false}
];

let list = document.getElementById("list");
let withdrawAmt = 0;

function render(){
  list.innerHTML="";
  withdrawLevels.forEach(w=>{
    if(w.once && usedOnce.includes(w.amt)) return;

    let r=document.createElement("div");
    r.className="row";
    r.innerHTML=`<div>Withdraw â‚¹${w.amt}</div><button class="btn">Apply</button>`;
    r.querySelector("button").onclick=()=>{
      if(balance<w.amt){alert("Balance à¤•à¤® à¤¹à¥ˆ");return;}
      withdrawAmt=w.amt;
      popup.style.display="flex";
    };
    list.appendChild(r);
  });
}

render();

function submitUPI(){
  let n=name.value,u=upi.value;
  if(!n||!u){alert("Details à¤­à¤°à¥‡à¤‚");return;}

  popup.style.display="none";
  loader.style.display="flex";
  status.innerText="â³ Processing...";

  setTimeout(()=>{
    status.innerText="ðŸ”” Pending";

    balance-=withdrawAmt;
    localStorage.setItem("balance",balance);
    bal.innerText=balance;

    history.push({amt:withdrawAmt,status:"Pending",time:new Date().toLocaleString()});
    localStorage.setItem("history",JSON.stringify(history));

    if(withdrawLevels.find(x=>x.amt==withdrawAmt).once){
      usedOnce.push(withdrawAmt);
      localStorage.setItem("usedOnce",JSON.stringify(usedOnce));
    }

    setTimeout(()=>{
      history[history.length-1].status="Success";
      localStorage.setItem("history",JSON.stringify(history));
      loader.style.display="none";
      alert("âœ… Withdraw Success");
      render();
    },3000);

  },2000);
}
</script>

</body>
</html>
