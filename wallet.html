<script>
// ================= INITIAL SETUP =================
if(!localStorage.getItem("balance")){
  localStorage.setItem("balance",500);
}
let balance = Number(localStorage.getItem("balance"));
bal.innerText = balance;

let history = JSON.parse(localStorage.getItem("history") || "[]");
let usedLevels = JSON.parse(localStorage.getItem("usedLevels") || "[]");

let amounts = [10,30,50,100,200,500];
let withdrawAmount = 0;

let list = document.getElementById("withdrawList");

// ================= RENDER AMOUNTS (NON CLICKABLE) =================
function renderWithdraw(){
  list.innerHTML="";

  amounts.forEach(a=>{
    if(a <= 100 && usedLevels.includes(a)) return;

    let div = document.createElement("div");
    div.className = "row";
    div.innerHTML = `
      <span>‚Çπ ${a}</span>
      <button class="btn withdrawBtn">Withdraw</button>
    `;

    div.querySelector(".withdrawBtn").onclick = ()=>{
      withdrawAmount = a;
      document.getElementById("amountInput").value = a;
      payPopup.style.display = "flex";
    };

    list.appendChild(div);
  });
}
renderWithdraw();

// ================= CONFIRM WITHDRAW =================
function confirmWithdraw(){
  let method = document.getElementById("method").value;
  let upi = document.getElementById("upi").value.trim();
  let amount = Number(document.getElementById("amountInput").value);

  if(!method || !upi || !amount){
    showStatus("‚ùå ‡§∏‡§≠‡•Ä details ‡§≠‡§∞‡•á‡§Ç","fail");
    return;
  }
  if(!upi.includes("@")){
    showStatus("‚ùå Invalid UPI","fail");
    return;
  }
  if(balance < amount){
    showStatus("‚ùå Balance ‡§ï‡§Æ ‡§π‡•à","fail");
    return;
  }

  payPopup.style.display="none";

  // Pending
  showStatus("‚è≥ Processing","pending");

  setTimeout(()=>{
    showStatus("üîî Pending","pending");
  },1500);

  setTimeout(()=>{
    balance -= amount;
    localStorage.setItem("balance",balance);
    bal.innerText = balance;

    history.unshift({
      amount:amount,
      method:method,
      status:"Success",
      time:new Date().toLocaleString()
    });
    localStorage.setItem("history",JSON.stringify(history));

    if(amount <= 100 && !usedLevels.includes(amount)){
      usedLevels.push(amount);
      localStorage.setItem("usedLevels",JSON.stringify(usedLevels));
    }

    showStatus("‚úÖ Success","success");
    renderWithdraw();
  },3000);
}

// ================= STATUS =================
function showStatus(msg,type){
  statusPopup.style.display="flex";
  statusText.innerText = msg;
  statusText.className = type;
  loader.style.display = (type==="pending") ? "block" : "none";

  if(type !== "pending"){
    setTimeout(()=>{
      statusPopup.style.display="none";
      loader.style.display="block";
    },2000);
  }
}
</script>
