<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scratch & Earn</title>
    <style>
        body { margin: 0; font-family: Arial; background: #f2f2f2; text-align: center; }
        .header { background: #16a085; color: #fff; padding: 15px; font-size: 20px; }
        
        /* Scratch Container */
        .scratch-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 40px auto;
            user-select: none;
        }
        
        /* Chupa hua paisa (Bottom Layer) */
        .reward-display {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #fff;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            border-radius: 15px;
            font-size: 24px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* Scratch Canvas (Top Layer) */
        #scratch-canvas {
            position: absolute;
            top: 0; left: 0;
            cursor: crosshair;
            border-radius: 15px;
            touch-action: none; /* Mobile touch smoothly kaam kare */
        }

        .btn {
            margin-top: 20px; padding: 12px 30px;
            background: #2ecc71; color: white;
            border: none; border-radius: 25px;
            font-size: 18px; display: none; cursor: pointer;
        }
        .limit { color: red; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">üéÅ Scratch & Win Cash</div>

<div class="scratch-container" id="container">
    <div class="reward-display">
        <span id="win-text">You Won</span>
        <span id="reward-amount">‚Çπ0</span>
    </div>
    <canvas id="scratch-canvas" width="250" height="250"></canvas>
</div>

<button class="btn" id="collectBtn" onclick="collect()">Claim Reward</button>
<div class="limit" id="limit"></div>

<script>
    const canvas = document.getElementById('scratch-canvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let reward = 0;
    let count = Number(localStorage.getItem("boxCount") || 0);

    // 1. Initial UI Setup
    function init() {
        if(count >= 3) {
            document.getElementById("limit").innerText = "‚ùå Aaj ke 3 Scratch khatam!";
            canvas.style.display = "none";
            return;
        }
        
        // Random Reward Generate karein
        const rewards = [2, 5, 10, 15];
        reward = rewards[Math.floor(Math.random() * rewards.length)];
        document.getElementById('reward-amount').innerText = "‚Çπ" + reward;

        // Canvas par Grey Color bharna (Ghisne ke liye layer)
        ctx.fillStyle = "#C0C0C0";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // "Scratch Here" text likhna
        ctx.fillStyle = "#333";
        ctx.font = "20px Arial";
        ctx.textAlign = "center";
        ctx.fillText("Ungli se ghisein", 125, 125);
    }

    // 2. Scratching Logic
    function scratch(e) {
        if (!isDrawing) return;
        
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || e.touches[0].clientX) - rect.left;
        const y = (e.clientY || e.touches[0].clientY) - rect.top;

        ctx.globalCompositeOperation = 'destination-out'; // Ye area ko mita deta hai
        ctx.beginPath();
        ctx.arc(x, y, 25, 0, Math.PI * 2); // 25px moti line se mitega
        ctx.fill();

        checkScratchPercentage();
    }

    // 3. Check kitna ghisa gaya
    function checkScratchPercentage() {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        let pixels = imageData.data;
        let clearPixels = 0;

        for (let i = 0; i < pixels.length; i += 4) {
            if (pixels[i + 3] === 0) clearPixels++;
        }

        // Agar 40% se zyada ghis diya toh reward button dikhayein
        if (clearPixels > (pixels.length / 4) * 0.4) {
            canvas.style.pointerEvents = "none";
            canvas.style.opacity = "0";
            document.getElementById('collectBtn').style.display = "inline-block";
        }
    }

    // Events (Mouse + Touch)
    canvas.addEventListener('mousedown', () => isDrawing = true);
    canvas.addEventListener('touchstart', () => isDrawing = true);
    window.addEventListener('mouseup', () => isDrawing = false);
    window.addEventListener('touchend', () => isDrawing = false);
    canvas.addEventListener('mousemove', scratch);
    canvas.addEventListener('touchmove', scratch);

    // 4. Balance mein add karna
    function collect() {
        let bal = Number(localStorage.getItem("balance") || 0);
        bal += reward;
        localStorage.setItem("balance", bal);
        
        count++;
        localStorage.setItem("boxCount", count);

        alert("Mubarak ho! ‚Çπ" + reward + " aapke wallet mein jud gaye.");
        location.reload(); // Page reload takki naya card aaye ya limit dikhaye
    }

    init();
</script>

</body>
</html>
